(()=>{"use strict";const e=["allrecipes.com","eatingwell.com","foodnetwork.com","food.com","simplyrecipes.com","seriouseats.com","budgetbytes.com","tasty.co","tastykitchen.com","skinnytaste.com","bbcgoodfood.com","thepioneerwoman.com","cooking.nytimes.com","sallysbakingaddiction.com","thespruceeats.com"],t="undefined"!=typeof browser?browser:chrome;function n(e){return e?e.replace(/\/$/,""):e}function a(e){try{const t=new URL(e);return("http:"===t.protocol||"https:"===t.protocol)&&t.hostname.length>0}catch{return!1}}async function o(){const e=n(document.getElementById("mealieUrl").value.trim()),o=document.getElementById("mealieApiToken").value.trim(),i=document.getElementById("enableDuplicateCheck").checked,c=e&&a(e)?e:"";await t.storage.sync.set({mealieUrl:c,mealieApiToken:o,enableDuplicateCheck:i})}function i(){document.getElementById("modal").classList.remove("active")}async function c(){const e=(await t.storage.sync.get({userSites:[]})||{}).userSites||[],n=document.getElementById("sitesList");if(n.replaceChildren(),0===e.length){const e=document.createElement("div");return e.style.cssText="padding: 8px; color: #999; text-align: center;",e.textContent="No custom sites added",void n.appendChild(e)}e.forEach(e=>{const a=document.createElement("div");a.className="site-item";const o=document.createElement("span");o.textContent=e;const i=document.createElement("button");i.textContent="Remove",i.addEventListener("click",async()=>{let n=(await t.storage.sync.get({userSites:[]})||{}).userSites||[];n=n.filter(t=>t!==e),await t.storage.sync.set({userSites:n});const a=`https://*.${e}/*`;t.permissions.remove({origins:[a]}).catch(()=>{}),await c()}),a.appendChild(o),a.appendChild(i),n.appendChild(a)})}document.getElementById("mealieUrl").addEventListener("input",o),document.getElementById("mealieApiToken").addEventListener("input",o),document.getElementById("enableDuplicateCheck").addEventListener("change",o),document.getElementById("testBtn").addEventListener("click",async function(){const e=n(document.getElementById("mealieUrl").value.trim()),o=document.getElementById("mealieApiToken").value.trim();if(a(e))try{const n=await fetch(`${e}/api/users/self`,{headers:{Authorization:`Bearer ${o}`}});n.ok?(await t.storage.sync.set({mealieUrl:e,mealieApiToken:o}),alert("Connection OK")):401===n.status?alert("Invalid API token"):alert("Connection failed")}catch(e){alert("Connection error")}else alert("Invalid Mealie URL. Must be HTTP or HTTPS.")}),document.getElementById("addSiteBtn").addEventListener("click",()=>{const e=document.getElementById("customSiteUrl").value.trim();e?(function(e){try{const n=new URL(e).hostname.replace(/^www\./,""),a=`https://*.${n}/*`;localStorage.setItem("pendingSiteUrl",e),t.permissions.request({origins:[a]}).then(async e=>{if(e){let e=(await t.storage.sync.get({userSites:[]})||{}).userSites||[];e.includes(n)?(localStorage.removeItem("pendingSiteUrl"),alert(`${n} is already added.`)):(e.push(n),await t.storage.sync.set({userSites:e}),localStorage.removeItem("pendingSiteUrl"),await c(),alert(`Site added: ${n}`))}else localStorage.removeItem("pendingSiteUrl"),alert("Permission denied.")})}catch(e){console.error("Error adding site"),alert("Invalid URL. Please enter a valid website URL (e.g., https://example.com or https://example.com/recipe/123).")}}(e),document.getElementById("customSiteUrl").value=""):alert("Please enter a valid URL.")}),document.getElementById("infoBtn").addEventListener("click",t=>{t.preventDefault(),function(){const t=document.getElementById("modal"),n=document.getElementById("defaultSitesList");n.replaceChildren(),e.forEach(e=>{const t=document.createElement("li");t.textContent=e,n.appendChild(t)}),t.classList.add("active")}()}),document.getElementById("modalClose").addEventListener("click",i),document.getElementById("modal").addEventListener("click",e=>{"modal"===e.target.id&&i()}),async function(){const e=await t.storage.sync.get(["mealieUrl","mealieApiToken","enableDuplicateCheck"])||{};document.getElementById("mealieUrl").value=e.mealieUrl||"",document.getElementById("mealieApiToken").value=e.mealieApiToken||"",document.getElementById("enableDuplicateCheck").checked=e.enableDuplicateCheck||!1;const n=localStorage.getItem("pendingSiteUrl");if(n){try{const e=new URL(n).hostname.replace(/^www\./,""),a=`https://*.${e}/*`;if(await t.permissions.contains({origins:[a]})){let n=(await t.storage.sync.get({userSites:[]})||{}).userSites||[];n.includes(e)||(n.push(e),await t.storage.sync.set({userSites:n}))}document.getElementById("customSiteUrl").value=""}catch(e){console.error("Error auto-saving site")}localStorage.removeItem("pendingSiteUrl")}c()}()})();
//# sourceMappingURL=popup.js.map