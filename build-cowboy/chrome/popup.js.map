{"version":3,"file":"popup.js","mappings":"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","sources":["webpack://send2mealie/./src/cowboy/whitelist.js","webpack://send2mealie/./src/cowboy/popup.js"],"sourcesContent":["// Default list of supported recipe domains.\n// These domains define where the extension may operate by default.\n// Additional sites may be added only with explicit user approval\n// via Chrome's optional host permission prompts.\nexport const DEFAULT_WHITELIST = [\n    \"allrecipes.com\",\n    \"eatingwell.com\",\n    \"foodnetwork.com\",\n    \"food.com\",\n    \"simplyrecipes.com\",\n    \"seriouseats.com\",\n    \"budgetbytes.com\",\n    \"tasty.co\",\n    \"tastykitchen.com\",\n    \"skinnytaste.com\",\n    \"bbcgoodfood.com\",\n    \"thepioneerwoman.com\",\n    \"cooking.nytimes.com\",\n    \"sallysbakingaddiction.com\",\n    \"thespruceeats.com\"\n];\n","import { DEFAULT_WHITELIST } from './whitelist.js';\n\n// Use browser namespace (Firefox) if available, otherwise chrome\nconst api = typeof browser !== 'undefined' ? browser : chrome;\n\nfunction trimSlash(u) { return u ? u.replace(/\\/$/, '') : u; }\n\n// Cowboy version: Allows HTTP and IP addresses for Mealie URL\n// This is for developer installations only, not for extension stores\nfunction isValidUrl(url) {\n  try {\n    const u = new URL(url);\n    // Allow both http and https, and IP addresses\n    return (u.protocol === 'http:' || u.protocol === 'https:') && u.hostname.length > 0;\n  } catch {\n    return false;\n  }\n}\n\nasync function autoSave() {\n  const mealieUrl = trimSlash(document.getElementById(\"mealieUrl\").value.trim());\n  const mealieApiToken = document.getElementById(\"mealieApiToken\").value.trim();\n  const enableDuplicateCheck = document.getElementById(\"enableDuplicateCheck\").checked;\n\n  const sanitizedUrl = mealieUrl && isValidUrl(mealieUrl) ? mealieUrl : \"\";\n  await api.storage.sync.set({ mealieUrl: sanitizedUrl, mealieApiToken, enableDuplicateCheck });\n}\n\nfunction showDefaultSitesModal() {\n  const modal = document.getElementById(\"modal\");\n  const listEl = document.getElementById(\"defaultSitesList\");\n  listEl.replaceChildren();\n  DEFAULT_WHITELIST.forEach(site => {\n    const li = document.createElement('li');\n    li.textContent = site;\n    listEl.appendChild(li);\n  });\n  modal.classList.add(\"active\");\n}\n\nfunction closeModal() {\n  const modal = document.getElementById(\"modal\");\n  modal.classList.remove(\"active\");\n}\n\nasync function load() {\n  const cfg = await api.storage.sync.get([\"mealieUrl\", \"mealieApiToken\", \"enableDuplicateCheck\"]) || {};\n  document.getElementById(\"mealieUrl\").value = cfg.mealieUrl || \"\";\n  document.getElementById(\"mealieApiToken\").value = cfg.mealieApiToken || \"\";\n  document.getElementById(\"enableDuplicateCheck\").checked = cfg.enableDuplicateCheck || false;\n\n  const pendingSiteUrl = localStorage.getItem(\"pendingSiteUrl\");\n  if (pendingSiteUrl) {\n    try {\n      const urlObj = new URL(pendingSiteUrl);\n      const domain = urlObj.hostname.replace(/^www\\./, '');\n      const origin = `https://*.${domain}/*`;\n\n      // Only add site if permission was actually granted\n      const hasPermission = await api.permissions.contains({ origins: [origin] });\n      if (hasPermission) {\n        const result = await api.storage.sync.get({ userSites: [] }) || {};\n        let userSites = result.userSites || [];\n\n        if (!userSites.includes(domain)) {\n          userSites.push(domain);\n          await api.storage.sync.set({ userSites });\n        }\n      }\n      document.getElementById(\"customSiteUrl\").value = \"\";\n    } catch (err) {\n      console.error(\"Error auto-saving site\");\n    }\n    localStorage.removeItem(\"pendingSiteUrl\");\n  }\n\n  renderSitesList();\n}\n\nasync function renderSitesList() {\n  const result = await api.storage.sync.get({ userSites: [] }) || {};\n  const userSites = result.userSites || [];\n  const listEl = document.getElementById(\"sitesList\");\n\n  listEl.replaceChildren();\n\n  if (userSites.length === 0) {\n    const emptyMsg = document.createElement('div');\n    emptyMsg.style.cssText = 'padding: 8px; color: #999; text-align: center;';\n    emptyMsg.textContent = 'No custom sites added';\n    listEl.appendChild(emptyMsg);\n    return;\n  }\n\n  userSites.forEach(site => {\n    const div = document.createElement('div');\n    div.className = 'site-item';\n\n    const span = document.createElement('span');\n    span.textContent = site;\n\n    const btn = document.createElement('button');\n    btn.textContent = 'Remove';\n    btn.addEventListener('click', async () => {\n      const result = await api.storage.sync.get({ userSites: [] }) || {};\n      let currentSites = result.userSites || [];\n      currentSites = currentSites.filter(s => s !== site);\n      await api.storage.sync.set({ userSites: currentSites });\n\n      const origin = `https://*.${site}/*`;\n      api.permissions.remove({ origins: [origin] }).catch(() => {});\n\n      await renderSitesList();\n    });\n\n    div.appendChild(span);\n    div.appendChild(btn);\n    listEl.appendChild(div);\n  });\n}\n\nasync function test() {\n  const mealieUrl = trimSlash(document.getElementById(\"mealieUrl\").value.trim());\n  const mealieApiToken = document.getElementById(\"mealieApiToken\").value.trim();\n  if (!isValidUrl(mealieUrl)) {\n    alert(\"Invalid Mealie URL. Must be HTTP or HTTPS.\");\n    return;\n  }\n  try {\n    // Use /api/users/self which requires valid authentication\n    const resp = await fetch(`${mealieUrl}/api/users/self`, {\n      headers: { Authorization: `Bearer ${mealieApiToken}` }\n    });\n    if (resp.ok) {\n      await api.storage.sync.set({ mealieUrl, mealieApiToken });\n      alert(\"Connection OK\");\n    } else if (resp.status === 401) {\n      alert(\"Invalid API token\");\n    } else {\n      alert(\"Connection failed\");\n    }\n  } catch (e) { alert(\"Connection error\"); }\n}\n\nasync function sendCurrent() {\n  const [tab] = await api.tabs.query({ active: true, currentWindow: true });\n  const { mealieUrl, mealieApiToken } = await api.storage.sync.get([\"mealieUrl\", \"mealieApiToken\"]);\n  if (!mealieUrl || !mealieApiToken) { alert(\"Please configure Mealie first.\"); return; }\n  api.runtime.sendMessage({ type: \"createViaApi\", url: tab.url });\n}\n\nfunction addUserSite(url) {\n  try {\n    const urlObj = new URL(url);\n    const domain = urlObj.hostname.replace(/^www\\./, '');\n    // Custom sites are limited to HTTPS origin permissions for consistency across stores\n    const origin = `https://*.${domain}/*`;\n\n    // Store pending URL before requesting permission (Firefox closes popup on permission request)\n    localStorage.setItem(\"pendingSiteUrl\", url);\n\n    // Request permission synchronously from click handler (required by Firefox)\n    api.permissions.request({ origins: [origin] }).then(async (granted) => {\n      if (granted) {\n        const result = await api.storage.sync.get({ userSites: [] }) || {};\n        let userSites = result.userSites || [];\n        if (!userSites.includes(domain)) {\n          userSites.push(domain);\n          await api.storage.sync.set({ userSites });\n          localStorage.removeItem(\"pendingSiteUrl\");\n          await renderSitesList();\n          alert(`Site added: ${domain}`);\n        } else {\n          localStorage.removeItem(\"pendingSiteUrl\");\n          alert(`${domain} is already added.`);\n        }\n      } else {\n        localStorage.removeItem(\"pendingSiteUrl\");\n        alert(\"Permission denied.\");\n      }\n    });\n  } catch (err) {\n    console.error(\"Error adding site\");\n    alert(\"Invalid URL. Please enter a valid website URL (e.g., https://example.com or https://example.com/recipe/123).\");\n  }\n}\n\ndocument.getElementById(\"mealieUrl\").addEventListener(\"input\", autoSave);\ndocument.getElementById(\"mealieApiToken\").addEventListener(\"input\", autoSave);\ndocument.getElementById(\"enableDuplicateCheck\").addEventListener(\"change\", autoSave);\n\ndocument.getElementById(\"testBtn\").addEventListener(\"click\", test);\ndocument.getElementById(\"addSiteBtn\").addEventListener(\"click\", () => {\n  const url = document.getElementById(\"customSiteUrl\").value.trim();\n  if (url) {\n    addUserSite(url);\n    document.getElementById(\"customSiteUrl\").value = \"\";\n  } else {\n    alert(\"Please enter a valid URL.\");\n  }\n});\n\ndocument.getElementById(\"infoBtn\").addEventListener(\"click\", (e) => {\n  e.preventDefault();\n  showDefaultSitesModal();\n});\n\ndocument.getElementById(\"modalClose\").addEventListener(\"click\", closeModal);\n\ndocument.getElementById(\"modal\").addEventListener(\"click\", (e) => {\n  if (e.target.id === \"modal\") {\n    closeModal();\n  }\n});\n\nload();\n"],"names":["DEFAULT_WHITELIST","api","browser","chrome","trimSlash","u","replace","isValidUrl","url","URL","protocol","hostname","length","async","autoSave","mealieUrl","document","getElementById","value","trim","mealieApiToken","enableDuplicateCheck","checked","sanitizedUrl","storage","sync","set","closeModal","classList","remove","renderSitesList","userSites","get","listEl","replaceChildren","emptyMsg","createElement","style","cssText","textContent","appendChild","forEach","site","div","className","span","btn","addEventListener","currentSites","filter","s","origin","permissions","origins","catch","resp","fetch","headers","Authorization","ok","alert","status","e","domain","localStorage","setItem","request","then","granted","includes","removeItem","push","err","console","error","addUserSite","preventDefault","modal","li","add","showDefaultSitesModal","target","id","cfg","pendingSiteUrl","getItem","contains","load"],"ignoreList":[],"sourceRoot":""}